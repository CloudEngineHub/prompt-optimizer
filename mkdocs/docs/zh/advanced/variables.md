# 变量管理（高级模式）

变量管理系统是 Prompt Optimizer 高级功能的核心，让你可以创建可复用的提示词模板。

## 🧰 变量系统概述

变量系统让你可以在提示词中使用占位符，并通过变量管理器统一管理这些变量的值。这对于创建可复用的提示词模板非常有用。

## 📝 变量类型

### 预定义变量（受保护）
系统内置的特殊变量，自动填充相关内容：

- `currentPrompt` - 当前优化的提示词内容
- `originalPrompt` - 原始未优化的提示词
- `lastOptimizedPrompt` - 上一次优化的结果
- `iterateInput` - 迭代优化的输入指令
- `userQuestion` - 用户提出的问题
- `conversationContext` - 对话上下文信息

注意：以上“预定义变量名”不可被保存为覆盖项（UI 会禁用或提示）；从上下文集合导入时也会自动剔除这些键名（统计为 predefinedVariablesRemoved）。

### 自定义变量
用户创建的变量：

- 可以是任意名称（不能与预定义变量冲突）
- 支持文本、数字、JSON等格式
- 可以在多个提示词间复用
- 支持动态更新和批量管理

## ⚙️ 变量管理操作

### 创建和编辑变量

1. **打开变量管理器**
   - 点击主界面的"变量管理"按钮
   - 或通过设置页面进入变量管理

2. **添加新变量**
   - 点击"新增变量"按钮
   - 输入变量名称（如：`userName`、`role`、`scenario`）
   - 输入变量值
   - 可选择添加描述说明变量用途

3. **编辑现有变量**
   - 在变量列表中点击要编辑的变量
   - 修改变量名或值
   - 保存更改

4. **删除变量**
   - 选择要删除的变量
   - 点击删除按钮确认删除

### 变量使用语法

在提示词中使用变量的语法：
```
你好 {{userName}}，你的角色是 {{role}}。
当前场景：{{scenario}}
请根据以下需求进行回复：{{userQuestion}}
```

### 变量预览功能

- **实时预览** - 在编辑提示词时实时看到变量替换效果
- **缺失检测** - 自动检测提示词中未定义的变量
- **智能提示** - 输入`{{`时自动提示可用变量
 - 一致性：预览与“缺失变量统计”均以 finalVars 为准（finalVars = 全局变量 ∪ 上下文覆盖，预定义名被剔除；同名以上下文覆盖优先）

## 🔄 上下文变量覆盖

高级功能支持在特定对话上下文中覆盖全局变量：

1. **全局变量** - 在变量管理器中定义，作用于所有场景
2. **上下文覆盖** - 在“上下文编辑器 → 变量”页设置，临时覆盖全局变量
3. **优先级/合并** - finalVars = 全局变量 ∪ 上下文覆盖；同名以上下文覆盖为准；预定义名不可覆盖

### 覆盖示例
```
全局变量：role = "助手"
上下文覆盖：role = "专业翻译"
最终结果：在当前对话中，{{role}} 将显示为"专业翻译"
```

## 📤 变量导入导出

### 导出变量
- 将变量配置导出为JSON文件
- 支持选择性导出部分变量
- 便于在不同设备间同步

### 导入变量
- 从JSON文件导入变量配置
- 支持批量导入
- 可选择覆盖或保留现有变量

### 上下文集合（context-bundle）
- 在“数据管理”中可导出/导入上下文集合（replace 模式），导入统计显示：imported/skipped/predefinedVariablesRemoved
- 在“上下文编辑器 → 导出（标准格式）”可导出单个上下文（含 messages/metadata.variables/tools）

## 💡 使用最佳实践

### 变量命名规范
1. **描述性命名** - 使用清晰、描述性的变量名
2. **驼峰命名** - 如 `userName`、`projectName`
3. **避免冲突** - 不与预定义变量重名
4. **分类管理** - 按功能或场景对变量进行分组

### 变量设计建议
1. **单一职责** - 每个变量专注一个数据项
2. **合理默认值** - 为变量设置合理的默认值
3. **文档说明** - 为复杂变量添加使用说明
4. **定期清理** - 删除不再使用的过时变量

---

**相关链接**：
- [工具调用](tools.md) - 工具调用中的变量使用
- [上下文管理](context.md) - 在对话上下文中管理变量
- [创意写作案例](../examples/creative-writing.md) - 变量管理在创意写作中的实际应用
